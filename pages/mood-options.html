<!DOCTYPE html>
<html lang="nl">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>MoodTunes - Customize Playlist</title>
    <link rel="stylesheet" href="../styles.css" />
  </head>

  <body>
    <div class="container light mood-options-container">
      <a href="scan.html" class="back-link">‚Üê Back</a>

      <p id="error" class="muted"></p>

      <h1 class="mood-title">You're <span id="mood-display">happy</span></h1>
      <p class="mood-subtitle">
        Choose how you want to respond to this feeling.
      </p>

      <div class="intent-options">
        <label class="intent-option" data-value="turn-it-up">
          <input type="radio" name="intent" value="turn-it-up" />
          <div class="checkbox-visual"></div>
          <span class="intent-label">Turn it up</span>
        </label>

        <label class="intent-option" data-value="take-it-easy">
          <input type="radio" name="intent" value="take-it-easy" />
          <div class="checkbox-visual"></div>
          <span class="intent-label">Take it easy</span>
        </label>

        <label class="intent-option" data-value="stay-focused">
          <input type="radio" name="intent" value="stay-focused" />
          <div class="checkbox-visual"></div>
          <span class="intent-label">Stay focused</span>
        </label>

        <label class="intent-option" data-value="go-with-flow">
          <input type="radio" name="intent" value="go-with-flow" />
          <div class="checkbox-visual"></div>
          <span class="intent-label">Go with the flow</span>
        </label>

        <label class="intent-option" data-value="change-the-mood">
          <input type="radio" name="intent" value="change-the-mood" />
          <div class="checkbox-visual"></div>
          <span class="intent-label">Change the mood</span>
        </label>
      </div>

      <button id="generate-btn" class="btn btn-primary generate-btn" disabled>
        Generate Playlist
      </button>

      <!-- Hidden elements for JS compatibility -->
      <span id="mood-result"></span>
      <select id="intent" style="display: none"></select>
    </div>

    <script type="module" src="../js/mood-options.js"></script>
    <script>
      document.addEventListener("DOMContentLoaded", () => {
        const gescandeEmotieData = localStorage.getItem("gescandeEmotie");
        const moodDisplay = document.getElementById("mood-display");
        const intentOptions = document.querySelectorAll(".intent-option");
        const generateBtn = document.getElementById("generate-btn");

        // Set detected mood
        if (gescandeEmotieData) {
          const alleenEmotie = gescandeEmotieData.split(" ")[0].toLowerCase();
          moodDisplay.innerText = alleenEmotie;
          localStorage.setItem("selectedMood", alleenEmotie);
        } else {
          moodDisplay.innerText = "neutral";
        }

        // Handle intent selection - select only, enable button
        intentOptions.forEach((option) => {
          option.addEventListener("click", () => {
            intentOptions.forEach((o) => o.classList.remove("selected"));
            option.classList.add("selected");
            option.querySelector('input[type="radio"]').checked = true;

            // Enable the generate button
            generateBtn.disabled = false;
          });
        });

        // Navigate only on Generate button click
        generateBtn.addEventListener("click", () => {
          const mood = moodDisplay.innerText;
          const selectedOption = document.querySelector(
            ".intent-option.selected"
          );
          if (!selectedOption) return;

          const intent = selectedOption.dataset.value;

          localStorage.setItem(
            "playlistOptions",
            JSON.stringify({ mood, intent, limit: 15 })
          );

          window.location.assign("./playlist.html");
        });
      });
    </script>
  </body>
</html>
